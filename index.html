<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shinees - Anime & Manga Platform</title>
    
    <!-- Scripts de Firebase (importante que estén en el <head>) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <style>
        /* --- FUENTES Y ESTILOS GLOBALES --- */
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;500;600;700&display=swap' );
        
        :root {
            --primary: #ff6b1a; --secondary: #23252b; --accent: #f47521; --text: #ffffff; --text-secondary: #a0a0a0; --bg: #000000; --bg-secondary: #141519; --bg-card: #1a1b1f; --border: #2a2b30;
        }
        [data-theme="light"] {
            --primary: #ff6b1a; --secondary: #ffffff; --text: #23252b; --text-secondary: #666666; --bg: #f5f5f5; --bg-secondary: #ffffff; --bg-card: #ffffff; --border: #e0e0e0;
        }
        [data-theme="girl"] {
            --primary: #ff69b4; --secondary: #ffc0cb; --text: #4b0082; --text-secondary: #9370db; --bg: #fff0f5; --bg-secondary: #ffe4e1; --bg-card: #ffdab9; --border: #ffc0cb;
        }
        [data-theme="boy"] {
            --primary: #1e90ff; --secondary: #00bfff; --text: #ffffff; --text-secondary: #add8e6; --bg: #191970; --bg-secondary: #4682b4; --bg-card: #5f9ea0; --border: #00bfff;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; transition: background 0.3s, color 0.3s; }
        * { margin: 0; padding: 0; box-sizing: border-box; }

        /* --- HEADER Y NAVEGACIÓN --- */
        header { background: var(--bg-secondary); padding: 0 20px; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border); }
        .header-container { max-width: 1400px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; height: 60px; }
        .logo-3d { font-family: 'Bebas Neue', cursive; font-size: 2.5rem; font-weight: bold; background: linear-gradient(45deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 30px rgba(255, 107, 26, 0.5); animation: float 3s ease-in-out infinite; cursor: pointer; transition: all 0.3s ease; perspective: 1000px; text-decoration: none; }
        .main-nav { display: flex; gap: 30px; align-items: center; }
        .nav-link { color: var(--text-secondary); text-decoration: none; font-size: 14px; font-weight: 500; transition: color 0.3s; position: relative; }
        .nav-link:hover { color: var(--primary); }
        .nav-link::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 0; height: 2px; background: var(--primary); transition: width 0.3s; }
        .nav-link:hover::after { width: 100%; }
        .search-container { position: relative; flex: 1; max-width: 400px; margin: 0 30px; }
        .search-input { width: 100%; padding: 8px 40px 8px 15px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; color: var(--text); font-size: 14px; transition: all 0.3s; }
        .search-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 10px rgba(255, 107, 26, 0.2); }
        .search-btn { position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: var(--primary); border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.3s; }
        .search-btn:hover { background: var(--accent); }
        .user-menu { display: flex; align-items: center; gap: 15px; }
        .user-avatar { width: 35px; height: 35px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.3s; font-weight: bold; }
        .user-avatar:hover { transform: scale(1.1); }
        .theme-toggle { background: none; border: none; color: var(--text); font-size: 20px; cursor: pointer; transition: transform 0.3s; }
        .theme-toggle:hover { transform: rotate(180deg); }

        /* --- PÁGINA PRINCIPAL: CARRUSEL Y GRIDS --- */
        .hero-carousel { position: relative; height: 450px; overflow: hidden; background: var(--bg-secondary); }
        .carousel-slide { position: absolute; width: 100%; height: 100%; opacity: 0; transition: opacity 1s; display: flex; align-items: center; }
        .carousel-slide.active { opacity: 1; }
        .carousel-content { position: relative; z-index: 2; padding: 0 60px; max-width: 600px; }
        .carousel-title { font-size: 3rem; font-weight: bold; margin-bottom: 20px; }
        .carousel-description { font-size: 1.1rem; margin-bottom: 30px; color: var(--text-secondary); }
        .watch-btn { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 10px; text-decoration: none; }
        .watch-btn:hover { background: var(--accent); transform: scale(1.05); }
        .carousel-image { position: absolute; right: 0; top: 0; width: 60%; height: 100%; object-fit: cover; mask-image: linear-gradient(to right, transparent, black 30%); -webkit-mask-image: linear-gradient(to right, transparent, black 30%); }
        .content-section { padding: 40px 20px; max-width: 1400px; margin: 0 auto; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-title { font-size: 1.8rem; font-weight: bold; }
        .view-all { color: var(--primary); text-decoration: none; font-weight: 500; display: flex; align-items: center; gap: 5px; transition: gap 0.3s; }
        .view-all:hover { gap: 10px; }
        .anime-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .anime-card { background: var(--bg-card); border-radius: 10px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; cursor: pointer; position: relative; opacity: 0; text-decoration: none; color: var(--text); }
        .anime-card:hover { transform: translateY(-10px); box-shadow: 0 10px 30px rgba(255, 107, 26, 0.3); }
        .anime-card img { width: 100%; height: 250px; object-fit: cover; }
        .anime-info { padding: 15px; }
        .anime-title { font-weight: 600; margin-bottom: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .anime-meta { font-size: 12px; color: var(--text-secondary); }
        .anime-badge { position: absolute; top: 10px; right: 10px; background: var(--primary); color: white; padding: 5px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        
        /* --- PÁGINA DE DETALLES --- */
        .detail-container { padding: 40px 20px; max-width: 1200px; margin: 0 auto; animation: fadeInUp 0.5s; }
        .detail-header { display: flex; gap: 30px; margin-bottom: 40px; }
        .detail-cover img { width: 250px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .detail-info h1 { font-size: 3rem; margin-bottom: 10px; }
        .detail-meta { display: flex; gap: 15px; color: var(--text-secondary); margin-bottom: 20px; }
        .detail-actions { display: flex; gap: 15px; margin-top: 20px; }
        .chapter-list { list-style: none; margin-top: 40px; }
        .chapter-item { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 10px; transition: all 0.2s; }
        .chapter-item:hover { border-color: var(--primary); transform: translateX(5px); }
        .chapter-item a { display: block; padding: 15px 20px; text-decoration: none; color: var(--text); }

        /* --- FOOTER --- */
        footer { background: var(--bg-secondary); padding: 40px 20px 20px; margin-top: 60px; border-top: 1px solid var(--border); }
        .footer-content { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; margin-bottom: 30px; }
        .footer-section h3 { margin-bottom: 15px; color: var(--primary); }
        .footer-links { list-style: none; }
        .footer-links li { margin-bottom: 10px; }
        .footer-links a { color: var(--text-secondary); text-decoration: none; transition: color 0.3s; }
        .footer-links a:hover { color: var(--primary); }
        .footer-bottom { text-align: center; padding-top: 20px; border-top: 1px solid var(--border); color: var(--text-secondary); }
        .social-links { display: flex; gap: 15px; }
        .social-link { width: 40px; height: 40px; background: var(--bg-card); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background 0.3s; text-decoration: none; }
        .social-link:hover { background: var(--primary); }

        /* --- ANIMACIONES Y RESPONSIVE --- */
        @media (max-width: 768px) { .main-nav { display: none; } .search-container { margin: 0 10px; } .carousel-content { padding: 0 20px; } .carousel-title { font-size: 2rem; } .anime-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; } .detail-header { flex-direction: column; } .detail-cover img { width: 100%; max-width: 250px; margin: 0 auto; } .detail-info h1 { font-size: 2.2rem; } }
        @keyframes float { 0%, 100% { transform: translateY(0) rotateX(0); } 50% { transform: translateY(-10px) rotateX(5deg); } }
        @keyframes rotate3d { 0% { transform: rotateY(0); } 100% { transform: rotateY(360deg); } }
        @keyframes slideInLeft { from { transform: translateX(-50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
    </style>
</head>
<body>
    <!-- HEADER (se mantiene en todas las vistas) -->
    <header>
        <div class="header-container">
            <a href="/" class="logo-3d">SHINEES</a>
            <nav class="main-nav">
                <a href="#" class="nav-link">Browse</a>
                <a href="#" class="nav-link">Manga</a>
            </nav>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Buscar..." id="searchInput">
                <button class="search-btn">🔍</button>
            </div>
            <div class="user-menu">
                <!-- Contenido dinámico por JS -->
            </div>
        </div>
    </header>

    <!-- CONTENEDOR PRINCIPAL (Aquí se renderizará todo) -->
    <div id="main-container">
        <!-- El contenido se genera aquí por JavaScript -->
    </div>

    <!-- FOOTER (se mantiene en todas las vistas) -->
    <footer>
        <div class="footer-content">
            <div class="footer-section"><h3>Navegación</h3><ul class="footer-links"><li><a href="/">Inicio</a></li><li><a href="#">Catálogo</a></li></ul></div>
            <div class="footer-section"><h3>Cuenta</h3><ul class="footer-links"><li><a href="#" id="footer-profile-link">Mi Perfil</a></li><li><a href="#" id="footer-logout-link">Cerrar sesión</a></li></ul></div>
            <div class="footer-section"><h3>Conecta</h3><div class="social-links"><a href="#" class="social-link">📘</a><a href="#" class="social-link">🐦</a></div></div>
            <div class="footer-section"><h3>Información</h3><ul class="footer-links"><li><a href="#">Sobre nosotros</a></li><li><a href="#">Términos de uso</a></li></ul></div>
        </div>
        <div class="footer-bottom"><p>© 2024 Shinees Platform. Todos los derechos reservados.</p></div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // =================================================================
        // 1. CONFIGURACIÓN
        // =================================================================
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyDsv2keytFIEeS4QT4_chwOHMgyWpV8gP4",
            authDomain: "shinees.firebaseapp.com",
            projectId: "shinees",
        };
        const GOOGLE_DRIVE_API_KEY = "TU_GOOGLE_DRIVE_API_KEY"; // <-- ¡IMPORTANTE!
        const DRIVE_FOLDER_ID = "TU_ID_DE_CARPETA_DE_GOOGLE_DRIVE"; // <-- ¡IMPORTANTE!

        firebase.initializeApp(FIREBASE_CONFIG);
        const auth = firebase.auth();
        const mainContainer = document.getElementById('main-container');

        // =================================================================
        // 2. LÓGICA DE LA INTERFAZ (Notificaciones, Modales, Temas)
        // =================================================================
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `position: fixed; top: 80px; right: 20px; background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#ff6b1a'}; color: white; padding: 15px 20px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 2000; animation: slideInRight 0.3s forwards;`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s forwards';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function renderModal(title, content) {
            const modalContainer = document.createElement('div');
            modalContainer.className = 'modal-overlay';
            modalContainer.style.cssText = `position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 2000;`;
            modalContainer.innerHTML = `<div class="modal-content" style="background: var(--bg-card); padding: 2rem; border-radius: 16px; width: 90%; max-width: 400px; position: relative;"><button class="modal-close-button" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--text); font-size: 1.5rem; cursor: pointer;">&times;</button><h2 style="margin-bottom: 1.5rem;">${title}</h2>${content}</div>`;
            document.body.appendChild(modalContainer);
        }

        function renderLoginModal() {
            renderModal('Iniciar Sesión', `<form id="login-form"><div style="margin-bottom: 1rem;"><label style="display: block; margin-bottom: 0.5rem;">Email:</label><input type="email" id="login-email" class="search-input" required /></div><div style="margin-bottom: 1rem;"><label style="display: block; margin-bottom: 0.5rem;">Contraseña:</label><input type="password" id="login-password" class="search-input" required /></div><button type="submit" class="watch-btn" style="width:100%;">Entrar</button></form>`);
        }

        function renderProfileModal(user) {
            renderModal('Mi Perfil', `<div style="text-align: center;"><div class="user-avatar" style="width: 80px; height: 80px; font-size: 2rem; margin: 0 auto 1rem;">${user.email.charAt(0).toUpperCase()}</div><h3>${user.displayName || user.email}</h3><p style="color: var(--text-secondary);">${user.email}</p><hr style="border-color: var(--border); margin: 1.5rem 0;"><button class="watch-btn" id="logout-btn" style="background: #ef4444; width: 100%;">Cerrar Sesión</button></div>`);
        }
        
        function toggleTheme() {
            const themes = ['dark', 'light', 'girl', 'boy'];
            let currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const currentIndex = themes.indexOf(currentTheme);
            const nextTheme = themes[(currentIndex + 1) % themes.length];
            document.documentElement.setAttribute('data-theme', nextTheme);
            const themeBtn = document.querySelector('.theme-toggle');
            if (themeBtn) {
                const icons = { 'dark': '🌙', 'light': '☀️', 'girl': '🌸', 'boy': '⚡' };
                themeBtn.textContent = icons[nextTheme];
            }
        }

        // =================================================================
        // 3. LÓGICA DE GOOGLE DRIVE
        // =================================================================
        async function findFileInDrive(fileName, folderId) {
            const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}' in parents and name='${fileName}' and trashed=false&key=${GOOGLE_DRIVE_API_KEY}`;
            const response = await fetch(url );
            if (!response.ok) throw new Error(`Error de red con la API de Drive: ${response.statusText}`);
            const data = await response.json();
            if (data.files.length === 0) return null;
            return data.files[0].id;
        }

        async function getDriveFileContent(fileId) {
            const url = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media&key=${GOOGLE_DRIVE_API_KEY}`;
            const response = await fetch(url );
            if (!response.ok) throw new Error(`No se pudo descargar el archivo de Drive: ${response.statusText}`);
            return await response.json();
        }

        // =================================================================
        // 4. RENDERIZADO DE VISTAS (PÁGINA PRINCIPAL Y DETALLES)
        // =================================================================
        function renderHomePage(seriesData) {
            mainContainer.innerHTML = `
                <div class="hero-carousel"></div>
                <main>
                    <section class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">🔥 Tendencias Ahora</h2>
                            <a href="#" class="view-all">Ver todo →</a>
                        </div>
                        <div class="anime-grid" id="trending-grid"></div>
                    </section>
                </main>`;
            
            const trendingGrid = document.getElementById('trending-grid');
            const carousel = document.querySelector('.hero-carousel');
            
            seriesData.forEach(serie => {
                trendingGrid.innerHTML += `<a href="?serie=${serie.id}" class="anime-card" data-id="${serie.id}"><img src="${serie.portada}" alt="${serie.titulo}"><div class="anime-info"><div class="anime-title">${serie.titulo}</div><div class="anime-meta">${serie.tipo} • ${serie.año}</div></div></a>`;
                if (serie.destacado) {
                    carousel.innerHTML += `<div class="carousel-slide ${carousel.children.length === 0 ? 'active' : ''}"><div class="carousel-content"><h1 class="carousel-title">${serie.titulo}</h1><p class="carousel-description">${serie.descripcion.substring(0, 100)}...</p><a href="?serie=${serie.id}" class="watch-btn">▶ Ver Ahora</a></div><img src="${serie.portada}" class="carousel-image"></div>`;
                }
            });
            document.querySelectorAll('.anime-card').forEach((card, index) => {
                card.style.animation = `fadeInUp 0.5s ${index * 0.05}s forwards`;
            });
        }

        function renderDetailPage(serieData) {
            mainContainer.innerHTML = `<div class="detail-container"><div class="detail-header"><div class="detail-cover"><img src="${serieData.portada}" alt="${serieData.titulo}"></div><div class="detail-info"><div class="detail-meta"><span>${serieData.tipo}</span> • <span>${serieData.estado}</span> • <span>${serieData.año}</span></div><h1>${serieData.titulo}</h1><p>${serieData.descripcion}</p><div class="detail-actions"><button class="watch-btn">▶ Empezar a ver</button><button class="watch-btn" style="background: var(--bg-card); color: var(--text);">+ Añadir a biblioteca</button></div></div></div><div class="detail-body"><h2>Episodios</h2><ul class="chapter-list">${(serieData.episodios || []).map(ep => `<li class="chapter-item"><a href="#">${ep.titulo}</a></li>`).join('')}</ul></div></div>`;
        }

        // =================================================================
        // 5. LÓGICA PRINCIPAL Y ROUTING
        // =================================================================
        async function router() {
            const params = new URLSearchParams(window.location.search);
            const serieId = params.get('serie');

            if (serieId) {
                showNotification(`Cargando ${serieId}...`, 'info');
                try {
                    // La lógica asume que cada serie tiene su propio archivo JSON nombrado como su ID.
                    const fileId = await findFileInDrive(`${serieId}.json`, DRIVE_FOLDER_ID);
                    if (!fileId) throw new Error("La serie no fue encontrada en Drive.");
                    const serieData = await getDriveFileContent(fileId);
                    renderDetailPage(serieData);
                } catch (error) {
                    console.error(error);
                    showNotification(error.message, 'error');
                    mainContainer.innerHTML = `<div class="content-section"><h1>Error 404</h1><p>La serie que buscas no existe. <a href="/">Volver al inicio</a></p></div>`;
                }
            } else {
                showNotification('Cargando catálogo...', 'info');
                try {
                    const indexFileId = await findFileInDrive('index.json', DRIVE_FOLDER_ID);
                    if (!indexFileId) throw new Error("El archivo 'index.json' no se encontró en la carpeta de Drive.");
                    const catalog = await getDriveFileContent(indexFileId);
                    renderHomePage(catalog.series);
                } catch (error) {
                    console.error(error);
                    showNotification(error.message, 'error');
                }
            }
        }

        // =================================================================
        // 6. MANEJO DE EVENTOS
        // =================================================================
        auth.onAuthStateChanged(user => {
            const userMenu = document.querySelector('.user-menu');
            if (!userMenu) return;
            if (user) {
                userMenu.innerHTML = `<button class="theme-toggle"></button><div class="user-avatar" id="user-avatar-btn" title="${user.email}">${user.email.charAt(0).toUpperCase()}</div>`;
            } else {
                userMenu.innerHTML = `<button class="theme-toggle"></button><button class="watch-btn" id="login-btn-header">Iniciar Sesión</button>`;
            }
            const themeBtn = userMenu.querySelector('.theme-toggle');
            if (themeBtn) {
                themeBtn.addEventListener('click', toggleTheme);
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
                const icons = { 'dark': '🌙', 'light': '☀️', 'girl': '🌸', 'boy': '⚡' };
                themeBtn.textContent = icons[currentTheme];
            }
        });

        document.addEventListener('click', async (e) => {
            if (e.target.id === 'login-btn-header') renderLoginModal();
            if (e.target.id === 'user-avatar-btn' && auth.currentUser) renderProfileModal(auth.currentUser);
            if (e.target.id === 'footer-profile-link') auth.currentUser ? renderProfileModal(auth.currentUser) : renderLoginModal();
            if (e.target.id === 'logout-btn' || e.target.id === 'footer-logout-link') {
                e.preventDefault();
                await auth.signOut();
                document.querySelector('.modal-overlay')?.remove();
                showNotification('Has cerrado sesión.', 'info');
            }
            if (e.target.classList.contains('modal-close-button') || e.target.classList.contains('modal-overlay')) {
                document.querySelector('.modal-overlay')?.remove();
            }
            if (e.target.closest('.anime-card')) {
                e.preventDefault();
                const serieId = e.target.closest('.anime-card').dataset.id;
                history.pushState({}, '', `?serie=${serieId}`);
                router();
            }
            if (e.target.closest('.search-btn')) {
                const query = document.getElementById('searchInput').value.trim();
                if (query) showNotification(`Buscando: "${query}"...`);
            }
        });

        document.body.addEventListener('submit', async (e) => {
            if (e.target.id === 'login-form') {
                e.preventDefault();
                const email = e.target.querySelector('#login-email').value;
                const password = e.target.querySelector('#login-password').value;
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    document.querySelector('.modal-overlay')?.remove();
                } catch (error) {
                    showNotification(`Error: ${error.message}`, 'error');
                }
            }
        });
        
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = e.target.value.trim();
                if (query) showNotification(`Buscando: "${query}"...`);
            }
        });

        window.addEventListener('popstate', router);

        // =================================================================
        // 7. EJECUCIÓN INICIAL
        // =================================================================
        router();
    });
    </script>
</body>
</html>
